<!doctype html>
{%load static%}
<html lang="en">
    <head>
        <title>Title</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="{% static 'css/style-user-poke.css' %}">
    </head>

    <body>
        <img class="background" src="{{ user.background.url }}" alt="background de {{ user.name }}" >

        <header>
            <div class="btn-headers">
                <a href="/">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                    </svg>
                </a>
                <a href="/edit_user_profile/{{user.id}}/">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person-gear" viewBox="0 0 16 16">
                        <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m.256 7a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1zm3.63-4.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
                    </svg>
                </a>
            </div>
        </header>

        <main>

            <img id="banner" class="banner" src="{{ user.banner.url }}" alt="Banner de {{ user.name }}" >

            
            <div id="info-headers" class="info-headers">

                <div id="info" class="info">
                    <img id="user-pic" class="user-pic" src="{{ user.photo.url }}" alt="Foto de {{ user.name }}">

                    <div>
                        <span class="name">{{user.name}}</span>
                        <span id="description" class="description">{{user.description}}</span>
                    </div>
                </div> 
               
            </div>

            <div class="totales">
                <span class="lista" >Capturados: {{captured_count}} de {{total_count}}</span> 

                <span class="capturados">Capturados: {{captured_count}} de {{total_count}}</span> 
                
                
                <form class="form-ordenar" method="GET" action="">
                    <select class="form-select" name="orden" onchange="this.form.submit()">
                        <option value="nombre_asc" {% if request.GET.orden == 'nombre_asc' %}selected{% endif %}>Nombre A-Z</option>
                        <option value="nombre_desc" {% if request.GET.orden == 'nombre_desc' %}selected{% endif %}>Nombre Z-A</option>
                    </select>
                </form>
                
            </div>

            <div id="contenedor" class="contenedor">
                    {% for fish_data in user_fishes %}
                    <div class="contenedor-pez  {{ fish_data.fish.tier }} ">
                        {% if fish_data.captured.captured %}
                            <div class="circle-si">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16">
                                    <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
                                </svg>
                            </div>
                        {% else %}
                            <div class="circle-no">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                </svg>
                            </div>
                        {% endif %}

                        <div class="carta-pez">
                            <span class="namepez">{{ fish_data.fish.name }} </span>    
                            <a href="/fish_detail/{{user.id}}/{{ fish_data.fish.id }}">
                            {% if fish_data.captured.captured %}
                                {% if fish_data.captured.prettiest_fish_photo %}
                                    <img class="img-pez" src="{{ fish_data.captured.prettiest_fish_photo.url }}" alt="{{ fish_data.fish.name }}">
                                {% else %}
                                    <img class="img-pez" src="{% static 'img/Pokemon-Magikarp-Silhouette-Stencil-thumb.jpg' %}" alt="{{ fish_data.fish.name }}">
                                {% endif %} 
                            {% else %}
                                    <img class="img-pez" src="{% static 'img/Pokemon-Magikarp-Silhouette-Stencil-thumb.jpg' %}" alt="{{ fish_data.fish.name }}">
                            {% endif %}   
                            </a>    
                        </div>
                    </div>
                {% endfor %}
                </div>
            </div>
        </main>

        <footer>
            <!-- place footer here -->
        </footer>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script>
document.addEventListener('DOMContentLoaded', function() {
    const userPic = document.getElementById("user-pic");
    const banner = document.getElementById("banner");
    const description = document.getElementById("description");
    const info = document.getElementById("info");
    const infoh = document.getElementById("info-headers");


    const stickyElement = document.querySelector(".info-headers");

    let isSticky = false; // Estado de si el elemento está en modo fijo o no
    const stickyOffset = stickyElement.offsetTop; // Donde comienza el sticky
    const margin = 75; // Un margen para prevenir el parpadeo cuando está cerca del tope

    // Función que detecta cuando el usuario hace scroll
    function onScroll() {
        const scrollTop = window.scrollY;

        // Cuando el scroll baja del tope y pasa el límite más el margen
        if (scrollTop > stickyOffset + margin && !isSticky) {
            userPic.classList.add("sticky");
            userPic.classList.remove("default");

            banner.classList.add("sticky");
            banner.classList.remove("default");

            description.classList.add("sticky");
            description.classList.remove("default");

            info.classList.add("sticky");
            info.classList.remove("default");

            infoh.classList.add("sticky");
            infoh.classList.remove("default");

            isSticky = true; // Marcamos que está fijo
        } 
        // Cuando el scroll sube y el scroll es menor que el límite menos el margen
        else if (scrollTop < stickyOffset - margin && isSticky) {
            userPic.classList.add("default");
            userPic.classList.remove("sticky");

            banner.classList.add("default");
            banner.classList.remove("sticky");

            description.classList.add("default");
            description.classList.remove("sticky");

            info.classList.add("default");
            info.classList.remove("sticky");

            infoh.classList.add("default");
            infoh.classList.remove("sticky");

            isSticky = false; // Marcamos que no está fijo
        }
    }

    // Escuchar el evento de scroll
    window.addEventListener('scroll', onScroll);

    // Llamar la función al cargar la página para comprobar el estado inicial
    onScroll();
});

        </script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
